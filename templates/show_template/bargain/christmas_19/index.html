<div class="summer">
    <link rel="stylesheet" type="text/css" href="templates/show_template/bargain/christmas_19/css/index.css"/>
    <div class="bargain_con">
        <div class="con_1">
            <audio id="bacMusic" src="" loop="loop"></audio>
            <span class="r_music" id="bacMusicBtn" btnType="on"></span>
            <img class="b_bg" src="templates/show_template/bargain/christmas_19/img/bg.png" alt="" />
            <img class="tree" src="templates/show_template/bargain/christmas_19/img/tree.png" alt=""/>
            <img class="snow" src="templates/show_template/bargain/christmas_19/img/snow1.png">
            <img class="titleBg" src="templates/show_template/bargain/christmas_19/img/titleBg.png" alt=""/>
            <img class="topsnow" src="templates/show_template/bargain/christmas_19/img/topsnow.png" alt=""/>
            <img class="word" src="templates/show_template/bargain/christmas_19/img/word.png" alt=""/>
            <img class="lingdang" src="templates/show_template/bargain/christmas_19/img/lingdang.png" alt=""/>
            <div class="con_1_c">
                <div class="con_1_text">
                    <div class="con_1_time">
                        <p>距截止<span>99</span>天<span>23</span>:<span>59</span>:<span>59</span></p>
                    </div>
                    <div class="s_peo">
                        <img src="templates/show_template/bargain/christmas_19/img/header.jpg" alt=""/>
                        <p>F*Y</p>
                    </div>
                    <div class="title_name">
                        <h3>XX成长教育春招促销大砍价</h3>
                    </div>

                    <div class="progress_wrapper">
                        <div class="progress_current">现价¥200.00</div>
                        <div class="progress_out"></div>
                        <div class="progress_in"></div>
                    </div>
                    <div class="priceCase">
                        <div>
                            <span class="mr10">底价¥200.00</span>
                            <span>剩余名额0份</span>
                        </div>
                        <div>
                            <span>原价¥1200.00</span>
                        </div>
                    </div>
                    <button class="con_1_btn"></button>
                </div>
            </div>
        </div>
            <div class="con_2 pos_ele_2">
                <h2 class="con_tit con_tit_1"></h2>
                <div class="con_box">
                    <div class="con_text">
                        <p>麦兜成长教育原价1000元幼儿小班课低至200元。</p>
                        <img src="templates/show_template/bargain/christmas_19/img/prizeimg.png" alt=""/>
                    </div>
                </div>
            </div>
            <div class="con_3 pos_ele_3">
                <h2 class="con_tit con_tit_2"></h2>
                <div class="con_box">
                    <div class="con_text">
                        <p></p>
                    </div>
                </div>
            </div>
            <div class="con_4">
                <h2 class="con_tit con_tit_3"></h2>
                <div class="con_box">
                    <div class="con_text">
                        <p class="s_nodata">暂无人砍价</p>
                    </div>
                </div>
            </div>
            <div class="con_5">
                <h2 class="con_tit con_tit_4"></h2>
                <div class="con_box">
                    <div class="con_text">
                        <p class="s_nodata">暂无排行</p>
                    </div>
                </div>
            </div>
            <div class="con_6 pos_ele_4">
                <h2 class="con_tit con_tit_5"></h2>
                <div class="con_box">
                    <div class="con_text">
                        <p>
                            麦兜成长教育创办于2000年，专注于少年儿童的兴趣教育，致力于让孩子更快乐、更轻松的学习，采用师生优化配对，根据学员年龄、性格特点、等实际情况推荐合适的老师，制定适合学员的教学方案及辅导考级。</p>
                        <img src="templates/show_template/bargain/christmas_19/img/organ_lis.png" alt=""/>
                    </div>
                </div>
            </div>
            <div class="copyright pos_ele_5">
                <span class="crumbs_6"></span>
                <div style="position: relative;">
                    <p class="copyright_erweima"></p>
                    <p class="copyright_organ">易知鸟教育培训</p>
                    <p class="copyright_phone">0571-85789582</p>
                    <p class="copyright_dress">杭州市上城区香榭商务大厦8楼8G</p>
                    <p style="margin-top: 0.2rem;"></p>
                </div>
            </div>
    </div>
    <script>
        var flag = true,timer;
        window.showTimer = true;
        clearInterval(timer);
        timer = setInterval(function(){
            if(flag){
                $('.snow').attr('src','templates/show_template/bargain/christmas_19/img/snow2.png');
                flag = false;
            }else{
                $('.snow').attr('src','templates/show_template/bargain/christmas_19/img/snow1.png');
                flag = true;
            }
        },1000)
        //渲染数据
        function getShowData(data) {
            // 如果没有数据则使用show.js里面的初始数据
            if (!data) {
                var data = h5_tempalteData['bargain/christmas_19'];
            }
            console.log('修改了数据', data);
            var organHtml = '';
            var music_url = '';
            var priceCaseHtml = '<div><span class="mr10">底价' + data.prizeInfo.floorPrice + '元</span><span>剩余名额' + data.prizeInfo.num + '份</span></div>';
            priceCaseHtml += '<div><span>原价' + data.prizeInfo.originalPrice + '元</span></div>';
            $('.priceCase').html(priceCaseHtml);
            $('.title_name h3').html(data.basicInfo.activityName);
            $('.con_3  .con_text p').html(data.prizeInfo.activityRule.replace(/\n/g, "<br/>"));

            var prizeHtml = '';
            //奖品列表信息
            for (var i = 0; i < data.prizeInfo.describeList.length; i++) {
                if(data.prizeInfo.describeList[i].type == 'text') {
                    prizeHtml += '<p>'+ data.prizeInfo.describeList[i].value.replace(/\n/g, "<br/>") +'</p>';
                } else {
                    prizeHtml += '<img src='+ data.prizeInfo.describeList[i].value +' alt="奖品描述图片">';
                }
            }
            $('.con_2 .con_text').html(prizeHtml);

            //判断是音乐库音乐还是自定义的音乐
            if (data.basicInfo.musicType == '0') {
                //判断用户是否选择了背景音乐
                if (data.basicInfo.bacMusic.musicId) {
                    //根据用户选择的音乐id去列表中寻找到音乐链接
                    for (var i = 0; i < data.musicList.length; i++) {
                        if (data.basicInfo.bacMusic.musicId == data.musicList[i].musicId) {
                            music_url = data.musicList[i].musicUrl;
                        }
                    }
                } else {
                    music_url = '';
                }
            } else {
                music_url = data.basicInfo.musicUrl;
            }
            ;

            //渲染音乐
            $('#bacMusicBtn').hide();
            $('#bacMusicBtn').attr('btnType', 'off');
            $('#bacMusicBtn').removeClass('music_rotate');
            if (music_url) {
                $('#bacMusic').attr('src', music_url);
                if (data.basicInfo.musicType == '0') {
                    $('#bacMusicBtn').show();
                    $('#audition_music').attr('btnType', 'on');
                    $('#audition_music')[0].className = 'add_info play_music';
                }
            } else {
                $('#bacMusic').attr('src', '');
                if (data.basicInfo.musicType == '0') {
                    $('#audition_music').attr('btnType', 'off');
                    $('#audition_music')[0].className = 'add_info off_music';
                }
            }

            //渲染底部信息
            if (data.organ.code) {
                $('.copyright_erweima').show();
                $('.copyright_erweima').html('<img src=' + data.organ.code + '> alt="校区二维码"');
            } else {
                $('.copyright_erweima').hide();
            }
            ;

            $('.copyright_organ').html(data.organ.name);
            $('.copyright_phone').html('电话: ' + data.organ.phone.join('  '));
            $('.copyright_dress').html('地址: ' + data.organ.address);

            //渲染校区介绍信息
            for (var i = 0; i < data.organInfo.length; i++) {
                if (data.organInfo[i].type == 'text') {
                    organHtml += '<p>' + data.organInfo[i].value.replace(/\n/g, "<br/>") + '</p>';
                } else {
                    organHtml += '<img src=' + data.organInfo[i].value + ' alt="校区介绍图片">';
                }
            }
            ;

            $('.con_6 .con_text').html(organHtml);

        }
        
        //雪花效果
        function snowEffect(window, ele, undefined) {
            console.log(ele)
            // 存储所有的雪花
            const snows = [];
        
            // 下落的加速度
            const G = 0.01;
        
            const fps = 60;
        
            // 速度上限，避免速度过快
            const SPEED_LIMIT_X = 1;
            const SPEED_LIMIT_Y = 1;
        
            const W = ele.width();
            const H = ele.height();
            console.log(H);
        
            let tickCount = 150;
            let ticker = 0;
            let lastTime = Date.now();
            let deltaTime = 0;
        
            let canvas = null;
            let ctx = null;
        
            let snowImage = null;
        
            window.requestAnimationFrame = (function() {
                return window.requestAnimationFrame ||
                    window.webkitRequestAnimationFrame ||
                    window.mozRequestAnimationFrame ||
                    window.oRequestAnimationFrame ||
                    window.msRequestAnimationFrame ||
                    function(callback) {
                        setTimeout(callback, 1000 / fps);
                    }
            })();
            
            function Snow(x, y, radius) {
                this.x = x;
                this.y = y;
                this.sx = 0;
                this.sy = 0;
                this.deg = 0;
                this.radius = radius;
                this.ax = Math.random() < 0.5 ? 0.005 : -0.005;
            }
        
            Snow.prototype.update = function() {
                const deltaDeg = Math.random() * 0.6 + 0.2;
        
                this.sx += this.ax;
                if(this.sx >= SPEED_LIMIT_X || this.sx <= -SPEED_LIMIT_X) {
                    this.ax *= -1;
                }
        
                if(this.sy < SPEED_LIMIT_Y) {
                    this.sy += G;
                }
        
                this.deg += deltaDeg;
                this.x += this.sx;
                this.y += this.sy;
            }
        
            Snow.prototype.draw = function() {
                const radius = this.radius;
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.rotate(this.deg * Math.PI / 180);
                ctx.drawImage(snowImage, -radius, -radius, radius * 2, radius * 2);
                ctx.restore();
            }
        
            function createCanvas() {
                canvas = document.createElement('canvas');
                console.log(canvas);
                ctx = canvas.getContext('2d');
            }
        
            init();
            function init() {
                createCanvas();
                canvas.width = W;
                canvas.height = H;
                canvas.style.cssText = 'position: absolute; top: 0; left: 0; pointer-events: none;z-index:2;';
                ele[0].appendChild(canvas);
                // 小屏幕时延长添加雪花时间，避免屏幕上出现太多的雪花
//              if(W < 768) {
//                  tickCount = 350;
//              }
        
                snowImage = new Image();
                snowImage.src = 'templates/show_template/group/christmas/img/snow.png';
        
                loop();
            }
        
            function loop() {
                try {
                    if(!window.showTimer) return;
                    requestAnimationFrame(loop);
            
                    ctx.clearRect(0, 0, W, H);
            
                    const now = Date.now();
                    deltaTime = now - lastTime;
                    lastTime = now;
                    ticker += deltaTime;
            
                    if(ticker > tickCount) {
                        snows.push(
                            new Snow(Math.random() * W, 0, Math.random() * 5 + 5)
                        );
                        ticker %= tickCount;
                    }
            
                    const length = snows.length;
                    snows.map(function(s, i) {
                        s.update();
                        s.draw();
                        if(s.y >= H) {
                            snows.splice(i, 1);
                        }
                    });
                }
                catch (arr) {
                    console.log(arr);
                    window.showTimer = false;
                }
            }
        };
        
        setTimeout(function() {
            snowEffect(window, $('.bargain_con'));
        }, 500);
            
    </script>
</div>